<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>í•­í˜„ì´ ì§‘ë“¤ì´</title>
  <!-- Fonts: êµ¬ê¸€ Noto Sans KR + Inter (ê¹”ë”í•œ í† ìŠ¤/êµ¬ê¸€ ëŠë‚Œ) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+KR:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0b0c10;
      --card: #14161c;
      --card-2: #191c23;
      --text: #eef2ff;
      --muted: #a6adbb;
      --accent: #7c3aed; /* purple */
      --accent-2: #06b6d4; /* cyan */
      --danger: #ef4444;
      --success: #22c55e;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 20px;
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; background: radial-gradient(1200px 600px at 80% -10%, rgba(124,58,237,.25), transparent 60%),
                           radial-gradient(1000px 500px at -10% 100%, rgba(6,182,212,.20), transparent 60%),
                           var(--bg);
      color:var(--text);
      font-family: Inter, "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, "Malgun Gothic", sans-serif;
      letter-spacing: -0.2px;
    }
    .app{ max-width: 780px; margin: 0 auto; padding: 16px 16px 96px; }

    /* Header */
    .header{ position: sticky; top:0; z-index: 20; backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(11,12,16,.85), rgba(11,12,16,.55));
      padding: 14px 16px; margin: -16px -16px 12px; border-bottom: 1px solid rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:space-between; }
    .title{ font-weight: 800; letter-spacing: -0.5px; cursor:pointer; display:flex; align-items:center; gap:10px; }
    .title span{ background: linear-gradient(90deg, var(--accent), var(--accent-2)); -webkit-background-clip: text; background-clip:text; color: transparent; }
    .badge{ font-size: 11px; padding: 4px 8px; border-radius: 999px; background: rgba(124,58,237,.15); color:#d8c8ff; }

    /* Hint */
    .hint{ font-size:12px; color:var(--muted); margin: 0 2px 10px; }

    .admin-btn{ display:none; }

    /* Current Tab label */
    .curtab{ font-size:13px; color:var(--muted); margin: 6px 2px 6px; }

    /* Card */
    .card{ background: linear-gradient(180deg, var(--card), var(--card-2)); border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius); padding:14px; box-shadow: var(--shadow); }

    /* Input Row */
    .row{ display:flex; gap:10px; align-items: stretch; }
    .row.wrap{ flex-wrap: wrap; }
    .row .grow{ flex:1; }
    input[type="text"], input[type="number"], textarea{
      width:100%; background:#0f1117; color:var(--text); border:1px solid rgba(255,255,255,.12);
      padding:14px 12px; border-radius: 14px; outline:none; font-size:15px;
    }
    textarea{ min-height: 88px; resize: vertical; }
    input::placeholder, textarea::placeholder{ color:#8a90a2; }
    .btn{ border:none; background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:white; padding:14px 16px; border-radius: 14px; font-weight:800; letter-spacing:.2px; cursor:pointer; box-shadow: 0 6px 20px rgba(124,58,237,.35); }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{ background:#0f1117; border:1px solid rgba(255,255,255,.14); box-shadow:none; font-weight:600; }
    .btn.danger{ background: linear-gradient(135deg, #ef4444, #f97316); box-shadow: 0 6px 20px rgba(239,68,68,.35); }

    /* List */
    .list{ display:flex; flex-direction:column; gap:10px; margin-top:12px; }
    .item{ display:flex; flex-direction:column; gap:8px; padding:12px; border:1px solid rgba(255,255,255,.06); border-radius: 14px; background: rgba(255,255,255,.02); }
    .toprow{ display:flex; align-items:center; gap:10px; }
    .item .txt{ flex:1; font-weight:700; }
    .item .desc{ display:none; color:var(--muted); white-space:pre-wrap; line-height:1.5; }
    .item.open .desc{ display:block; }
    .item.clickable{ cursor:pointer; }
    .actions{ display:flex; align-items:center; gap:8px; }
    .heart{ display:flex; gap:6px; align-items:center; border:1px solid rgba(255,255,255,.10); padding:8px 10px; border-radius:12px; cursor:pointer; }
    .heart[data-liked="true"]{ background: rgba(124,58,237,.18); border-color: rgba(124,58,237,.45); }
    .del{ border:1px solid rgba(255,255,255,.10); padding:8px 10px; border-radius:12px; cursor:pointer; }
    .del:hover{ border-color: rgba(255,255,255,.25); }

    /* Top 3 grid */
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 560px){ .grid{ grid-template-columns: 1fr 1fr; } }

    /* Bottom Tabs */
    .tabs{ position: fixed; bottom: 12px; left: 0; right: 0; z-index: 30; display:flex; justify-content:center; pointer-events:none; }
    .tabs-inner{ pointer-events:auto; display:flex; gap:10px; background: rgba(20,22,28,.85); border:1px solid rgba(255,255,255,.08); padding:8px; border-radius: 20px; backdrop-filter: blur(8px); box-shadow: var(--shadow); }
    .tab{ flex:1; min-width: 72px; text-align:center; padding:10px 12px; border-radius:14px; color:var(--muted); font-weight:700; cursor:pointer; border:1px solid transparent; }
    .tab.active{ color:var(--text); background: rgba(124,58,237,.16); border-color: rgba(124,58,237,.35); }

    /* Modal */
    .modal{ position: fixed; inset:0; display:none; place-items:center; background: rgba(0,0,0,.6); z-index: 50; }
    .modal.open{ display:grid; }
    .paper{ background: radial-gradient(120% 120% at 0% 0%, rgba(124,58,237,.25), rgba(255,255,255,.03)), #0f1117; color:var(--text); border:1px solid rgba(255,255,255,.10); border-radius: 24px; padding: 36px 28px; text-align:center; box-shadow: var(--shadow); }
    .hip{ font-size: clamp(22px, 6vw, 36px); font-weight: 800; letter-spacing: -0.6px; line-height: 1.2; background: linear-gradient(90deg, #22d3ee, #a78bfa, #fb7185, #22d3ee); -webkit-background-clip: text; background-clip:text; color:transparent; animation: move 4s linear infinite; background-size: 300% 100%; }
    @keyframes move{ 0%{ background-position:0% 50%; } 100%{ background-position:100% 50%; } }
    .sub{ color:var(--muted); margin-top:10px; font-size:13px; }

    /* Toast */
    .toast{ position: fixed; bottom: 78px; left:50%; transform: translateX(-50%); background: #111827; color:#e5e7eb; border:1px solid rgba(255,255,255,.10); padding:10px 14px; border-radius:12px; display:none; z-index: 60; box-shadow: var(--shadow); }
    .toast.show{ display:block; }
  </style>
</head>
<body>
  <div class="header">
    <div class="title" id="titleBtn" aria-label="í•­í˜„ì´ ì§‘ë“¤ì´">
      <span>í•­í˜„ì´ ì§‘ë“¤ì´</span>
      <div class="badge">Party Mode âœ¦</div>
    </div>
  </div>

  <div class="app">
    <div class="curtab" id="curTab">í˜„ì¬ íƒ­: ë¨¹ê±°ë¦¬</div>
    <div class="hint">ê° í•­ëª©ì„ í´ë¦­í•˜ë©´ ì„¤ëª…ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

    <!-- Composer -->
    <div class="card" id="composer">
      <div class="row" style="margin-bottom:10px;">
        <input id="newText" class="grow" type="text" maxlength="72" placeholder="ì œëª© (ì˜ˆ: ì‚¼ê²¹ì‚´ / ë§ˆë¼íƒ• / í¬ì»¤ / ì„¤ê±°ì§€ ë‹´ë‹¹)" />
        <input id="pin" type="number" inputmode="numeric" pattern="\\d{4}" placeholder="4ìë¦¬" title="4ìë¦¬ ë¹„ë°€ë²ˆí˜¸" />
        <button class="btn" id="addBtn">ë“±ë¡</button>
      </div>
      <div class="row wrap" style="gap:10px;">
        <textarea id="newDesc" class="grow" placeholder="ì„¤ëª… (ì„ íƒ) â€” ì˜ˆ: ê³ ê¸°, ìŒˆì±„ì†Œ, ì½œë¼ëŠ” ë‚´ê°€ ì‚¬ì˜¬ê²Œ! ë˜ëŠ” ê²Œì„ ë°©ì‹/ë£°, í• ì¼ ìƒì„¸ ë“±"></textarea>
      </div>
      <div style="font-size:12px; color:var(--muted); margin-top:6px;">í•­ëª©ë§ˆë‹¤ 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ê°™ì€ ë²ˆí˜¸ë¡œ í•´ë‹¹ í•­ëª©ì„ ì‚­ì œí•  ìˆ˜ ìˆì–´ìš”.</div>
    </div>

    <!-- Lists -->
    <div class="list" id="list"></div>

    <!-- Rank (Top 3) -->
    <div id="rank" style="display:none; margin-top:10px;">
      <div class="grid">
        <div class="card"><h3 style="margin:0 0 8px;">ğŸ½ï¸ ë¨¹ê±°ë¦¬ Top 3</h3><div id="r-food"></div></div>
        <div class="card"><h3 style="margin:0 0 8px;">ğŸ® ê²Œì„ Top 3</h3><div id="r-game"></div></div>
        <div class="card"><h3 style="margin:0 0 8px;">ğŸ§½ í• ì¼ Top 3</h3><div id="r-todo"></div></div>
      </div>
    </div>
  </div>

  <!-- Bottom Tabs -->
  <div class="tabs">
    <div class="tabs-inner">
      <div class="tab active" data-tab="food">ğŸ½ï¸ ë¨¹ê±°ë¦¬</div>
      <div class="tab" data-tab="game">ğŸ® ê²Œì„</div>
      <div class="tab" data-tab="todo">ğŸ§½ í• ì¼</div>
      <div class="tab" data-tab="rank">ğŸ† ìˆœìœ„</div>
    </div>
  </div>

  <!-- Hip Modal -->
  <div class="modal" id="hipModal" role="dialog" aria-modal="true">
    <div class="paper">
      <div class="hip">ê¸¸ë™ê¼¬ì¶” ì§‘ë“¤ì´ ë ˆì¸ ê¸°ë¦¿</div>
      <div class="sub">í™”ë©´ì„ íƒ­í•˜ë©´ ë‹«í˜€ìš” âœ¨</div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // ---- Data Layer ----
    const STORE_KEY = 'houseparty_v2';
    const LIKE_KEY  = 'houseparty_likes_v2'; // per-device liked item ids

    const state = {
      tab: 'food', // food | game | todo | rank
      data: loadData(),
      likes: loadLikes(),
    };

    function loadData(){
      try{ const raw = localStorage.getItem(STORE_KEY); return raw? JSON.parse(raw) : { food: [], game: [], todo: [] }; }
      catch(e){ return { food: [], game: [], todo: [] }; }
    }
    function saveData(){ localStorage.setItem(STORE_KEY, JSON.stringify(state.data)); }

    function loadLikes(){
      try{ const raw = localStorage.getItem(LIKE_KEY); return raw? new Set(JSON.parse(raw)) : new Set(); }
      catch(e){ return new Set(); }
    }
    function saveLikes(){ localStorage.setItem(LIKE_KEY, JSON.stringify(Array.from(state.likes))); }

    function uid(){ return Math.random().toString(36).slice(2, 10); }

    // ---- UI Helpers ----
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function toast(msg){
      const el = $('#toast'); el.textContent = msg; el.classList.add('show');
      setTimeout(()=> el.classList.remove('show'), 1800);
    }

    function escapeText(t){ return t.replace(/[&<>\"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;'}[s])); }

    // ---- Rendering ----
    function render(){
      $$('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab===state.tab));
      $('#curTab').textContent = 'í˜„ì¬ íƒ­: ' + (state.tab==='food'?'ë¨¹ê±°ë¦¬': state.tab==='game'?'ê²Œì„': state.tab==='todo'?'í• ì¼':'ìˆœìœ„');

      const isRank = state.tab === 'rank';
      $('#composer').style.display = isRank ? 'none' : 'block';
      $('#list').style.display = isRank ? 'none' : 'flex';
      $('#rank').style.display = isRank ? 'block' : 'none';

      if(!isRank){
        const arr = [...state.data[state.tab]];
        arr.sort((a,b)=> (b.heart - a.heart) || (a.ts - b.ts));
        const list = $('#list'); list.innerHTML = '';
        arr.forEach(item => list.appendChild(renderItem(item)));
      } else {
        renderRank();
      }
    }

    function renderItem(item){
      const wrap = document.createElement('div');
      wrap.className = 'item clickable';
      wrap.dataset.id = item.id;

      const toprow = document.createElement('div');
      toprow.className = 'toprow';

      const txt = document.createElement('div');
      txt.className = 'txt';
      txt.textContent = item.text;

      const actions = document.createElement('div'); actions.className='actions';

      const heart = document.createElement('button');
      heart.className='heart';
      const liked = state.likes.has(item.id);
      heart.dataset.liked = liked ? 'true' : 'false';
      heart.innerHTML = liked ? `ğŸ’œ <b>${item.heart}</b>` : `â¤ï¸ <b>${item.heart}</b>`;
      heart.setAttribute('aria-label','í•˜íŠ¸');
      heart.addEventListener('click', (e)=>{ e.stopPropagation(); toggleLike(item.id); });

      const del = document.createElement('button');
      del.className='del'; del.innerHTML = 'ğŸ—‘ï¸ ì‚­ì œ';
      del.addEventListener('click', (e)=>{ e.stopPropagation(); tryDelete(item.id); });

      actions.append(heart, del);
      toprow.append(txt, actions);

      const desc = document.createElement('div');
      desc.className = 'desc';
      desc.textContent = item.desc ? item.desc : 'ì„¤ëª…ì´ ì—†ì–´ìš”';

      wrap.append(toprow, desc);

      // click to toggle description
      wrap.addEventListener('click', ()=> wrap.classList.toggle('open'));

      return wrap;
    }

    function renderRank(){
      const topN = (arr)=> [...arr].sort((a,b)=> (b.heart-a.heart)||(a.ts-b.ts)).slice(0,3)
        .map((x,i)=>`<div style="display:flex;align-items:center;gap:10px; margin:6px 0;">
          <div style="width:26px;height:26px;display:grid;place-items:center;border-radius:8px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-weight:800;">${i+1}</div>
          <div style="flex:1;font-weight:700;">${escapeText(x.text)}</div>
          <div style="opacity:.9;">â¤ï¸ ${x.heart}</div>
        </div>`).join('') || '<div style="color:var(--muted)">ì•„ì§ í•­ëª©ì´ ì—†ì–´ìš”.</div>';
      $('#r-food').innerHTML = topN(state.data.food);
      $('#r-game').innerHTML = topN(state.data.game);
      $('#r-todo').innerHTML = topN(state.data.todo);
    }

    // ---- Actions ----
    function addItem(){
      const input = $('#newText');
      const descEl = $('#newDesc');
      const pinEl = $('#pin');
      const text = (input.value || '').trim();
      const desc = (descEl.value || '').trim();
      const pin = (pinEl.value || '').trim();
      if(!text){ toast('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
      if(!/^\d{4}$/.test(pin)){ toast('4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
      const item = { id: uid(), text, desc, pin, heart: 0, ts: Date.now() };
      state.data[state.tab].push(item);
      saveData(); input.value=''; pinEl.value=''; descEl.value='';
      toast('ë“±ë¡ ì™„ë£Œ!'); render();
    }

    function toggleLike(id){
      const arrAll = state.data.food.concat(state.data.game, state.data.todo);
      const item = arrAll.find(x=> x.id===id); if(!item) return;
      if(state.likes.has(id)){
        // unlike
        if(item.heart>0) item.heart -= 1;
        state.likes.delete(id);
        saveLikes(); saveData(); render();
      } else {
        // like
        item.heart += 1; state.likes.add(id);
        saveLikes(); saveData(); render();
      }
    }

    function tryDelete(id){
      const pinTry = prompt('í•´ë‹¹ í•­ëª© ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)');
      if(pinTry===null) return; // cancel
      if(!/^\d{4}$/.test(pinTry)) { toast('4ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
      const catKeys = ['food','game','todo'];
      for(const k of catKeys){
        const idx = state.data[k].findIndex(x=> x.id===id);
        if(idx>-1){
          if(state.data[k][idx].pin === pinTry){
            state.data[k].splice(idx,1);
            if(state.likes.has(id)) { state.likes.delete(id); saveLikes(); }
            saveData(); toast('ì‚­ì œ ì™„ë£Œ'); render();
          } else {
            toast('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
          }
          return;
        }
      }
    }

    // ---- Tab / UI wiring ----
    $('#titleBtn').addEventListener('click', ()=> $('#hipModal').classList.add('open'));
    $('#hipModal').addEventListener('click', ()=> $('#hipModal').classList.remove('open'));

    $('#addBtn').addEventListener('click', addItem);
    $('#newText').addEventListener('keydown', (e)=>{ if(e.key==='Enter') addItem(); });
    $('#pin').addEventListener('keydown', (e)=>{ if(e.key==='Enter') addItem(); });

    $$('.tab').forEach(t=> t.addEventListener('click', ()=>{ state.tab = t.dataset.tab; render(); }));

    // Initial paint
    render();
  </script>
</body>
</html>
